
\documentclass{article}


\usepackage{listings}

\title{Test, test me do: unit testing for infectious disease modelling}
\author{Tim CD Lucas, Tim Pollington, Deirdre Hollingsworth, et al.}


\begin{document}



% use covid Ferguson as mitigating example.
% https://twitter.com/neil_ferguson/status/1241835454707699713?s=19

% frameworks
%.  testthat and packages
%.  test in Julia
%.  add python

% continuous integration

% good practice
%.   small functions

% what to test
%.  edge cases. 0, others?
%.  types
%.  dims
%.  bounds


% how to test random
%.   non random bit. p= 0
%.   separate the random bit
%.   large numbers and bounds

\maketitle

\section{abstract}

We use code.

Noone is bug free.

it is important that out code is correct because people live or die

buggy code is biased code

people currently use as hoc testing

really we should be doing unit testing

unit testing is formally defined tests in a framework that encourages them to be regularly run.

\section{Introduction}

Infectious disease modellers write lots of code.
That code is important because it directs policy.
examples include covid and another example where models have directly influenced policy.

Given that modelling is important, it is important for the code to be correct.
Neil Ferguson got flack for coffee that wasnt written with software best practices.
Furthermore, buggy code is biased code, with an example.
However, most researchers currently do tests as hoc and only once.

unit testing is a framework for doing this properly.
useful frameworks are readily available in r and Julia and python.
infectious disease modelling presents some specific challenges such as stochastic code.
in this primer we introduce unit testing and demonstrate its use on an example infectious disease model.
we give specific recommendations for the problems specific to infectious disease modelling.
we also give an overview of the testing frameworks and continuous integration options available.




\section{ example}

Consider a multistrain system, where a population of $N$ individuals who get reinfected once per time step. 
Each individual is defined by the strain they are currently infected with $I_{it} \in \{'a', 'b', 'c'\}$ and so the the population is defined by the length $N$ vector of states $\mathbf{I_t}$.
Then each time step, the infection status of each individual is updated
$$I_{it} = Unif(\mathbf{I{t-1}}).$$

Here then is our first attempt at implementing this model.

\begin{lstlisting}

N <- 99
T <- 200
I <- matrix(NA, ncom = N, nrow = T)
I[1, ] <- rep(c("a", "b", "c"), N / 3)

for(t in seq(2, T)){
  I[t, ] <- sample(I[t - 1, ], N)
}
\end{lstlisting}


\end{document}




